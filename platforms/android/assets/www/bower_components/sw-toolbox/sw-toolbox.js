/*
  Copyright 2014 Google Inc. All Rights Reserved.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
*/

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.toolbox=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){"use strict";function r(e,t){return a.openCache(t).then(function(t){return t.add(e)})}function i(e,t){return a.openCache(t).then(function(t){return t["delete"](e)})}function s(e){Array.isArray(e)||(e=[e]),o.preCacheItems=o.preCacheItems.concat(e)}e("serviceworker-cache-polyfill");var o=e("./options"),u=e("./router"),a=e("./helpers"),f=e("./strategies");a.debug("Service Worker Toolbox is loading");var l=function(e){return e.reduce(function(e,t){return e.concat(t)},[])};self.addEventListener("install",function(e){var t=o.cacheName+"$$$inactive$$$";a.debug("install event fired"),a.debug("creating cache ["+t+"]"),e.waitUntil(a.openCache({cacheName:t}).then(function(e){return Promise.all(o.preCacheItems).then(l).then(function(t){return a.debug("preCache list: "+(t.join(", ")||"(none)")),e.addAll(t)})}))}),self.addEventListener("activate",function(e){a.debug("activate event fired");var t=o.cacheName+"$$$inactive$$$";e.waitUntil(a.renameCache(t,o.cacheName))}),self.addEventListener("fetch",function(e){var t=u.match(e.request);t?e.respondWith(t(e.request)):u["default"]&&e.respondWith(u["default"](e.request))}),t.exports={networkOnly:f.networkOnly,networkFirst:f.networkFirst,cacheOnly:f.cacheOnly,cacheFirst:f.cacheFirst,fastest:f.fastest,router:u,options:o,cache:r,uncache:i,precache:s}},{"./helpers":2,"./options":3,"./router":5,"./strategies":9,"serviceworker-cache-polyfill":14}],2:[function(e,t,n){"use strict";function r(e,t){t=t||{};var n=t.debug||u.debug;n&&console.log("[sw-toolbox] "+e)}function i(e){e=e||{};var t=e.cacheName||u.cacheName;return r('Opening cache "'+t+'"',e),caches.open(t)}function s(e,t){t=t||{};var n=t.successResponses||u.successResponses;return fetch(e.clone()).then(function(r){return"GET"===e.method&&n.test(r.status)&&i(t).then(function(t){t.put(e,r)}),r.clone()})}function o(e,t,n){return r("Renaming cache: ["+e+"] to ["+t+"]",n),caches["delete"](t).then(function(){return Promise.all([caches.open(e),caches.open(t)]).then(function(t){var n=t[0],r=t[1];return n.keys().then(function(e){return Promise.all(e.map(function(e){return n.match(e).then(function(t){return r.put(e,t)})}))}).then(function(){return caches["delete"](e)})})})}var u=e("./options");t.exports={debug:r,fetchAndCache:s,openCache:i,renameCache:o}},{"./options":3}],3:[function(e,t,n){"use strict";var r;r=self.registration?self.registration.scope:self.scope||(new URL("./",self.location)).href,t.exports={cacheName:"$$$toolbox-cache$$$"+r+"$$$",debug:!1,networkTimeoutSeconds:null,preCacheItems:[],successResponses:/^0|([123]\d\d)|(40[14567])|410$/}},{}],4:[function(e,t,n){"use strict";var r=new URL("./",self.location),i=r.pathname,s=e("path-to-regexp"),o=function(e,t,n,r){0!==t.indexOf("/")&&(t=i+t),this.method=e,this.keys=[],this.regexp=s(t,this.keys),this.options=r,this.handler=n};o.prototype.makeHandler=function(e){var t=this.regexp.exec(e),n={};return this.keys.forEach(function(e,r){n[e.name]=t[r+1]}),function(e){return this.handler(e,n,this.options)}.bind(this)},t.exports=o},{"path-to-regexp":12}],5:[function(e,t,n){"use strict";function r(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var i=e("./route"),s=function(e,t){for(var n=e.entries(),r=n.next();!r.done;){var i=new RegExp(r.value[0]);if(i.test(t))return r.value[1];r=n.next()}return null},o=function(){this.routes=new Map,this["default"]=null};["get","post","put","delete","head","any"].forEach(function(e){o.prototype[e]=function(t,n,r){return this.add(e,t,n,r)}}),o.prototype.add=function(e,t,n,s){s=s||{};var o=s.origin||self.location.origin;o=o instanceof RegExp?o.source:r(o),e=e.toLowerCase();var u=new i(e,t,n,s);this.routes.has(o)||this.routes.set(o,new Map);var a=this.routes.get(o);a.has(e)||a.set(e,new Map);var f=a.get(e);f.set(u.regexp.source,u)},o.prototype.matchMethod=function(e,t){t=new URL(t);var n=t.origin,r=t.pathname;e=e.toLowerCase();var i=s(this.routes,n);if(!i)return null;var o=i.get(e);if(!o)return null;var u=s(o,r);return u?u.makeHandler(r):null},o.prototype.match=function(e){return this.matchMethod(e.method,e.url)||this.matchMethod("any",e.url)},t.exports=new o},{"./route":4}],6:[function(e,t,n){"use strict";function r(e,t,n){return i.debug("Strategy: cache first ["+e.url+"]",n),i.openCache(n).then(function(t){return t.match(e).then(function(t){return t?t:i.fetchAndCache(e,n)})})}var i=e("../helpers");t.exports=r},{"../helpers":2}],7:[function(e,t,n){"use strict";function r(e,t,n){return i.debug("Strategy: cache only ["+e.url+"]",n),i.openCache(n).then(function(t){return t.match(e)})}var i=e("../helpers");t.exports=r},{"../helpers":2}],8:[function(e,t,n){"use strict";function r(e,t,n){return i.debug("Strategy: fastest ["+e.url+"]",n),new Promise(function(t,r){var o=!1,u=[],a=function(e){u.push(e.toString()),o?r(new Error('Both cache and network failed: "'+u.join('", "')+'"')):o=!0},f=function(e){e instanceof Response?t(e):a("No result returned")};i.fetchAndCache(e.clone(),n).then(f,a),s(e,n).then(f,a)})}var i=e("../helpers"),s=e("./cacheOnly");t.exports=r},{"../helpers":2,"./cacheOnly":7}],9:[function(e,t,n){t.exports={networkOnly:e("./networkOnly"),networkFirst:e("./networkFirst"),cacheOnly:e("./cacheOnly"),cacheFirst:e("./cacheFirst"),fastest:e("./fastest")}},{"./cacheFirst":6,"./cacheOnly":7,"./fastest":8,"./networkFirst":10,"./networkOnly":11}],10:[function(e,t,n){"use strict";function r(e,t,n){n=n||{};var r=n.successResponses||i.successResponses,o=n.networkTimeoutSeconds||i.networkTimeoutSeconds;return s.debug("Strategy: network first ["+e.url+"]",n),s.openCache(n).then(function(t){var i,u=[];if(o){var a=new Promise(function(n){i=setTimeout(function(){t.match(e).then(function(e){e&&n(e)})},1e3*o)});u.push(a)}var f=s.fetchAndCache(e,n).then(function(e){if(i&&clearTimeout(i),r.test(e.status))return e;throw s.debug("Response was an HTTP error: "+e.statusText,n),new Error("Bad response")})["catch"](function(){return s.debug("Network or response error, fallback to cache ["+e.url+"]",n),t.match(e)});return u.push(f),Promise.race(u)})}var i=e("../options"),s=e("../helpers");t.exports=r},{"../helpers":2,"../options":3}],11:[function(e,t,n){"use strict";function r(e,t,n){return i.debug("Strategy: network only ["+e.url+"]",n),fetch(e)}var i=e("../helpers");t.exports=r},{"../helpers":2}],12:[function(e,t,n){function r(e){for(var t,n=[],r=0,i=0,s="";null!=(t=m.exec(e));){var o=t[0],a=t[1],f=t.index;if(s+=e.slice(i,f),i=f+o.length,a)s+=a[1];else{s&&(n.push(s),s="");var l=t[2],c=t[3],h=t[4],p=t[5],d=t[6],v=t[7],g="+"===d||"*"===d,y="?"===d||"*"===d,b=l||"/",w=h||p||(v?".*":"[^"+b+"]+?");n.push({name:c||r++,prefix:l||"",delimiter:b,optional:y,repeat:g,pattern:u(w)})}}return i<e.length&&(s+=e.substr(i)),s&&n.push(s),n}function i(e){return s(r(e))}function s(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(t[n]=new RegExp("^"+e[n].pattern+"$"));return function(n){for(var r="",i=n||{},s=0;s<e.length;s++){var o=e[s];if("string"!=typeof o){var u,a=i[o.name];if(null==a){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to be defined')}if(v(a)){if(!o.repeat)throw new TypeError('Expected "'+o.name+'" to not repeat, but received "'+a+'"');if(0===a.length){if(o.optional)continue;throw new TypeError('Expected "'+o.name+'" to not be empty')}for(var f=0;f<a.length;f++){if(u=encodeURIComponent(a[f]),!t[s].test(u))throw new TypeError('Expected all "'+o.name+'" to match "'+o.pattern+'", but received "'+u+'"');r+=(0===f?o.prefix:o.delimiter)+u}}else{if(u=encodeURIComponent(a),!t[s].test(u))throw new TypeError('Expected "'+o.name+'" to match "'+o.pattern+'", but received "'+u+'"');r+=o.prefix+u}}else r+=o}return r}}function o(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function u(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function a(e,t){return e.keys=t,e}function f(e){return e.sensitive?"":"i"}function l(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)t.push({name:r,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return a(e,t)}function c(e,t,n){for(var r=[],i=0;i<e.length;i++)r.push(d(e[i],t,n).source);var s=new RegExp("(?:"+r.join("|")+")",f(n));return a(s,t)}function h(e,t,n){for(var i=r(e),s=p(i,n),o=0;o<i.length;o++)"string"!=typeof i[o]&&t.push(i[o]);return a(s,t)}function p(e,t){t=t||{};for(var n=t.strict,r=t.end!==!1,i="",s=e[e.length-1],u="string"==typeof s&&/\/$/.test(s),a=0;a<e.length;a++){var l=e[a];if("string"==typeof l)i+=o(l);else{var c=o(l.prefix),h=l.pattern;l.repeat&&(h+="(?:"+c+h+")*"),h=l.optional?c?"(?:"+c+"("+h+"))?":"("+h+")?":c+"("+h+")",i+=h}}return n||(i=(u?i.slice(0,-2):i)+"(?:\\/(?=$))?"),i+=r?"$":n&&u?"":"(?=\\/|$)",new RegExp("^"+i,f(t))}function d(e,t,n){return t=t||[],v(t)?n||(n={}):(n=t,t=[]),e instanceof RegExp?l(e,t,n):v(e)?c(e,t,n):h(e,t,n)}var v=e("isarray");t.exports=d,t.exports.parse=r,t.exports.compile=i,t.exports.tokensToFunction=s,t.exports.tokensToRegExp=p;var m=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g")},{isarray:13}],13:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],14:[function(e,t,n){Cache.prototype.addAll||(Cache.prototype.addAll=function(e){function t(e){this.name="NetworkError",this.code=19,this.message=e}var n=this;return t.prototype=Object.create(Error.prototype),Promise.resolve().then(function(){if(arguments.length<1)throw new TypeError;return e=e.map(function(e){return e instanceof Request?e:String(e)}),Promise.all(e.map(function(e){"string"==typeof e&&(e=new Request(e));var n=(new URL(e.url)).protocol;if("http:"!==n&&"https:"!==n)throw new t("Invalid scheme");return fetch(e.clone())}))}).then(function(t){return Promise.all(t.map(function(t,i){return n.put(e[i],t)}))}).then(function(){return void 0})})},{}]},{},[1])(1)});