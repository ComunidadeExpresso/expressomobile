function Texture(e,t,n,r,i){EventEmitter.call(this),this.noFrame=!1,t||(this.noFrame=!0,t=new math.Rectangle(0,0,1,1)),e instanceof Texture&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=r,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=n||t,this.rotate=!!i,e.hasLoaded?(this.noFrame&&(t=new math.Rectangle(0,0,e.width,e.height),e.on("update",this.onBaseTextureUpdated,this)),this.frame=t):e.once("loaded",this.onBaseTextureLoaded,this)}var BaseTexture=require("./BaseTexture"),VideoBaseTexture=require("./VideoBaseTexture"),TextureUvs=require("./TextureUvs"),EventEmitter=require("eventemitter3"),math=require("../math"),utils=require("../utils");Texture.prototype=Object.create(EventEmitter.prototype),Texture.prototype.constructor=Texture,module.exports=Texture,Object.defineProperties(Texture.prototype,{frame:{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1,this.width=e.width,this.height=e.height;if(!this.trim&&!this.rotate&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=e&&e.width&&e.height&&this.baseTexture.hasLoaded,this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=this.trim.width,this._frame.height=this.trim.height):this.crop=e,this.valid&&this._updateUvs()}}}),Texture.prototype.update=function(){this.baseTexture.update()},Texture.prototype.onBaseTextureLoaded=function(e){this.noFrame?this.frame=new math.Rectangle(0,0,e.width,e.height):this.frame=this._frame,this.emit("update",this)},Texture.prototype.onBaseTextureUpdated=function(e){this._frame.width=e.width,this._frame.height=e.height,this.emit("update",this)},Texture.prototype.destroy=function(e){this.baseTexture&&(e&&this.baseTexture.destroy(),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.crop=null,this.valid=!1,this.off("dispose",this.dispose,this),this.off("update",this.update,this)},Texture.prototype.clone=function(){return new Texture(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)},Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new TextureUvs),this._uvs.set(this.crop,this.baseTexture,this.rotate)},Texture.fromImage=function(e,t,n){var r=utils.TextureCache[e];return r||(r=new Texture(BaseTexture.fromImage(e,t,n)),utils.TextureCache[e]=r),r},Texture.fromFrame=function(e){var t=utils.TextureCache[e];if(!t)throw new Error('The frameId "'+e+'" does not exist in the texture cache');return t},Texture.fromCanvas=function(e,t){return new Texture(BaseTexture.fromCanvas(e,t))},Texture.fromVideo=function(e,t){return typeof e=="string"?Texture.fromVideoUrl(e,t):new Texture(VideoBaseTexture.fromVideo(e,t))},Texture.fromVideoUrl=function(e,t){return new Texture(VideoBaseTexture.fromUrl(e,t))},Texture.addTextureToCache=function(e,t){utils.TextureCache[t]=e},Texture.removeTextureFromCache=function(e){var t=utils.TextureCache[e];return delete utils.TextureCache[e],delete utils.BaseTextureCache[e],t},Texture.EMPTY=new Texture(new BaseTexture);