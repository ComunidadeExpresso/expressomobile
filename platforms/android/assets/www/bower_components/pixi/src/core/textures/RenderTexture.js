function RenderTexture(e,t,n,r,i){if(!e)throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");t=t||100,n=n||100,i=i||CONST.RESOLUTION;var s=new BaseTexture;s.width=t,s.height=n,s.resolution=i,s.scaleMode=r||CONST.SCALE_MODES.DEFAULT,s.hasLoaded=!0,Texture.call(this,s,new math.Rectangle(0,0,t,n)),this.width=t,this.height=n,this.resolution=i,this.render=null,this.renderer=e;if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var o=this.renderer.gl;this.textureBuffer=new RenderTarget(o,this.width,this.height,s.scaleMode,this.resolution),this.baseTexture._glTextures[o.id]=this.textureBuffer.texture,this.filterManager=new FilterManager(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(t,n),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),this.renderer.currentRenderTarget.activate()}else this.render=this.renderCanvas,this.textureBuffer=new CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()}var BaseTexture=require("./BaseTexture"),Texture=require("./Texture"),RenderTarget=require("../renderers/webgl/utils/RenderTarget"),FilterManager=require("../renderers/webgl/managers/FilterManager"),CanvasBuffer=require("../renderers/canvas/utils/CanvasBuffer"),math=require("../math"),CONST=require("../const"),tempMatrix=new math.Matrix;RenderTexture.prototype=Object.create(Texture.prototype),RenderTexture.prototype.constructor=RenderTexture,module.exports=RenderTexture,RenderTexture.prototype.resize=function(e,t,n){if(e===this.width&&t===this.height)return;this.valid=e>0&&t>0,this.width=this._frame.width=this.crop.width=e,this.height=this._frame.height=this.crop.height=t,n&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height);if(!this.valid)return;this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height)},RenderTexture.prototype.clear=function(){if(!this.valid)return;this.renderer.type===CONST.RENDERER_TYPE.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},RenderTexture.prototype.renderWebGL=function(e,t,n,r){if(!this.valid)return;r=r!==undefined?r:!0,this.textureBuffer.transform=t,this.textureBuffer.activate(),e.worldAlpha=1;if(r){e.worldTransform.identity(),e.currentBounds=null;var i=e.children,s,o;for(s=0,o=i.length;s<o;++s)i[s].updateTransform()}var u=this.renderer.filterManager;this.renderer.filterManager=this.filterManager,this.renderer.renderDisplayObject(e,this.textureBuffer,n),this.renderer.filterManager=u},RenderTexture.prototype.renderCanvas=function(e,t,n,r){if(!this.valid)return;r=!!r;var i=tempMatrix;i.identity(),t&&i.append(t),e.worldTransform=i;var s=e.worldTransform;e.worldAlpha=1;var o=e.children,u,a;for(u=0,a=o.length;u<a;++u)o[u].updateTransform();n&&this.textureBuffer.clear();var f=this.textureBuffer.context,l=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(e,f),this.renderer.resolution=l,e.worldTransform=s},RenderTexture.prototype.destroy=function(){Texture.prototype.destroy.call(this,!0),this.textureBuffer.destroy(),this.filterManager&&this.filterManager.destroy(),this.renderer=null},RenderTexture.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var e=this.renderer.gl,t=this.textureBuffer.size.width,n=this.textureBuffer.size.height,r=new Uint8Array(4*t*n);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,t,n,e.RGBA,e.UNSIGNED_BYTE,r),e.bindFramebuffer(e.FRAMEBUFFER,null);var i=new CanvasBuffer(t,n),s=i.context.getImageData(0,0,t,n);return s.data.set(r),i.context.putImageData(s,0,0),i.canvas}return this.textureBuffer.canvas},RenderTexture.prototype.getPixels=function(){var e,t;if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var n=this.renderer.gl;e=this.textureBuffer.size.width,t=this.textureBuffer.size.height;var r=new Uint8Array(4*e*t);return n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),n.readPixels(0,0,e,t,n.RGBA,n.UNSIGNED_BYTE,r),n.bindFramebuffer(n.FRAMEBUFFER,null),r}return e=this.textureBuffer.canvas.width,t=this.textureBuffer.canvas.height,this.textureBuffer.canvas.getContext("2d").getImageData(0,0,e,t).data},RenderTexture.prototype.getPixel=function(e,t){if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var n=this.renderer.gl,r=new Uint8Array(4);return n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),n.readPixels(e,t,1,1,n.RGBA,n.UNSIGNED_BYTE,r),n.bindFramebuffer(n.FRAMEBUFFER,null),r}return this.textureBuffer.canvas.getContext("2d").getImageData(e,t,1,1).data};