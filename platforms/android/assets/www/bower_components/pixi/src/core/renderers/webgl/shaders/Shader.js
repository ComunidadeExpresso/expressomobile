function Shader(e,t,n,r,i){if(!t||!n)throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");this.uid=utils.uid(),this.gl=e.renderer.gl,this.shaderManager=e,this.program=null,this.uniforms=r||{},this.attributes=i||{},this.textureCount=1,this.vertexSrc=t,this.fragmentSrc=n,this.init()}var utils=require("../../../utils");Shader.prototype.constructor=Shader,module.exports=Shader,Shader.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},Shader.prototype.cacheUniformLocations=function(e){for(var t=0;t<e.length;++t)this.uniforms[e[t]]._location=this.gl.getUniformLocation(this.program,e[t])},Shader.prototype.cacheAttributeLocations=function(e){for(var t=0;t<e.length;++t)this.attributes[e[t]]=this.gl.getAttribLocation(this.program,e[t])},Shader.prototype.compile=function(){var e=this.gl,t=this._glCompile(e.VERTEX_SHADER,this.vertexSrc),n=this._glCompile(e.FRAGMENT_SHADER,this.fragmentSrc),r=e.createProgram();return e.attachShader(r,t),e.attachShader(r,n),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",e.getProgramParameter(r,e.VALIDATE_STATUS)),console.error("gl.getError()",e.getError()),e.getProgramInfoLog(r)!==""&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(r)),e.deleteProgram(r),r=null),e.deleteShader(t),e.deleteShader(n),this.program=r},Shader.prototype.syncUniform=function(e){var t=e._location,n=e.value,r=this.gl,i,s;switch(e.type){case"b":case"bool":case"boolean":r.uniform1i(t,n?1:0);break;case"i":case"1i":r.uniform1i(t,n);break;case"f":case"1f":r.uniform1f(t,n);break;case"2f":r.uniform2f(t,n[0],n[1]);break;case"3f":r.uniform3f(t,n[0],n[1],n[2]);break;case"4f":r.uniform4f(t,n[0],n[1],n[2],n[3]);break;case"v2":r.uniform2f(t,n.x,n.y);break;case"v3":r.uniform3f(t,n.x,n.y,n.z);break;case"v4":r.uniform4f(t,n.x,n.y,n.z,n.w);break;case"1iv":r.uniform1iv(t,n);break;case"2iv":r.uniform2iv(t,n);break;case"3iv":r.uniform3iv(t,n);break;case"4iv":r.uniform4iv(t,n);break;case"1fv":r.uniform1fv(t,n);break;case"2fv":r.uniform2fv(t,n);break;case"3fv":r.uniform3fv(t,n);break;case"4fv":r.uniform4fv(t,n);break;case"m2":case"mat2":case"Matrix2fv":r.uniformMatrix2fv(t,e.transpose,n);break;case"m3":case"mat3":case"Matrix3fv":r.uniformMatrix3fv(t,e.transpose,n);break;case"m4":case"mat4":case"Matrix4fv":r.uniformMatrix4fv(t,e.transpose,n);break;case"c":typeof n=="number"&&(n=utils.hex2rgb(n)),r.uniform3f(t,n[0],n[1],n[2]);break;case"iv1":r.uniform1iv(t,n);break;case"iv":r.uniform3iv(t,n);break;case"fv1":r.uniform1fv(t,n);break;case"fv":r.uniform3fv(t,n);break;case"v2v":e._array||(e._array=new Float32Array(2*n.length));for(i=0,s=n.length;i<s;++i)e._array[i*2]=n[i].x,e._array[i*2+1]=n[i].y;r.uniform2fv(t,e._array);break;case"v3v":e._array||(e._array=new Float32Array(3*n.length));for(i=0,s=n.length;i<s;++i)e._array[i*3]=n[i].x,e._array[i*3+1]=n[i].y,e._array[i*3+2]=n[i].z;r.uniform3fv(t,e._array);break;case"v4v":e._array||(e._array=new Float32Array(4*n.length));for(i=0,s=n.length;i<s;++i)e._array[i*4]=n[i].x,e._array[i*4+1]=n[i].y,e._array[i*4+2]=n[i].z,e._array[i*4+3]=n[i].w;r.uniform4fv(t,e._array);break;case"t":case"sampler2D":if(!e.value||!e.value.baseTexture.hasLoaded)break;r.activeTexture(r["TEXTURE"+this.textureCount]);var o=e.value.baseTexture._glTextures[r.id];o||(this.initSampler2D(e),o=e.value.baseTexture._glTextures[r.id]),r.bindTexture(r.TEXTURE_2D,o),r.uniform1i(e._location,this.textureCount),this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+e.type)}},Shader.prototype.syncUniforms=function(){this.textureCount=1;for(var e in this.uniforms)this.syncUniform(this.uniforms[e])},Shader.prototype.initSampler2D=function(e){var t=this.gl,n=e.value.baseTexture;if(!n.hasLoaded)return;if(e.textureData){var r=e.textureData;n._glTextures[t.id]=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,r.luminance?t.LUMINANCE:t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r.magFilter?r.magFilter:t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,r.wrapS?r.wrapS:t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,r.wrapS?r.wrapS:t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,r.wrapT?r.wrapT:t.CLAMP_TO_EDGE)}else this.shaderManager.renderer.updateTexture(n)},Shader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this.uniforms=null,this.attributes=null,this.vertexSrc=null,this.fragmentSrc=null},Shader.prototype._glCompile=function(e,t){var n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(console.log(this.gl.getShaderInfoLog(n)),null)};