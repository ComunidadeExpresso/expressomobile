var CONST=require("../../../const"),CanvasGraphics={};module.exports=CanvasGraphics,CanvasGraphics.renderGraphics=function(e,t){var n=e.worldAlpha;e.dirty&&(this.updateGraphicsTint(e),e.dirty=!1);for(var r=0;r<e.graphicsData.length;r++){var i=e.graphicsData[r],s=i.shape,o=i._fillTint,u=i._lineTint;t.lineWidth=i.lineWidth;if(i.type===CONST.SHAPES.POLY){t.beginPath();var a=s.points;t.moveTo(a[0],a[1]);for(var f=1;f<a.length/2;f++)t.lineTo(a[f*2],a[f*2+1]);s.closed&&t.lineTo(a[0],a[1]),a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke())}else if(i.type===CONST.SHAPES.RECT){if(i.fillColor||i.fillColor===0)t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fillRect(s.x,s.y,s.width,s.height);i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.strokeRect(s.x,s.y,s.width,s.height))}else if(i.type===CONST.SHAPES.CIRC)t.beginPath(),t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke());else if(i.type===CONST.SHAPES.ELIP){var l=s.width*2,c=s.height*2,h=s.x-l/2,p=s.y-c/2;t.beginPath();var d=.5522848,v=l/2*d,m=c/2*d,g=h+l,y=p+c,b=h+l/2,w=p+c/2;t.moveTo(h,w),t.bezierCurveTo(h,w-m,b-v,p,b,p),t.bezierCurveTo(b+v,p,g,w-m,g,w),t.bezierCurveTo(g,w+m,b+v,y,b,y),t.bezierCurveTo(b-v,y,h,w+m,h,w),t.closePath(),i.fill&&(t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill()),i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke())}else if(i.type===CONST.SHAPES.RREC){var E=s.x,S=s.y,x=s.width,T=s.height,N=s.radius,C=Math.min(x,T)/2|0;N=N>C?C:N,t.beginPath(),t.moveTo(E,S+N),t.lineTo(E,S+T-N),t.quadraticCurveTo(E,S+T,E+N,S+T),t.lineTo(E+x-N,S+T),t.quadraticCurveTo(E+x,S+T,E+x,S+T-N),t.lineTo(E+x,S+N),t.quadraticCurveTo(E+x,S,E+x-N,S),t.lineTo(E+N,S),t.quadraticCurveTo(E,S,E,S+N),t.closePath();if(i.fillColor||i.fillColor===0)t.globalAlpha=i.fillAlpha*n,t.fillStyle="#"+("00000"+(o|0).toString(16)).substr(-6),t.fill();i.lineWidth&&(t.globalAlpha=i.lineAlpha*n,t.strokeStyle="#"+("00000"+(u|0).toString(16)).substr(-6),t.stroke())}}},CanvasGraphics.renderGraphicsMask=function(e,t){var n=e.graphicsData.length;if(n===0)return;t.beginPath();for(var r=0;r<n;r++){var i=e.graphicsData[r],s=i.shape;if(i.type===CONST.SHAPES.POLY){var o=s.points;t.moveTo(o[0],o[1]);for(var u=1;u<o.length/2;u++)t.lineTo(o[u*2],o[u*2+1]);o[0]===o[o.length-2]&&o[1]===o[o.length-1]&&t.closePath()}else if(i.type===CONST.SHAPES.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(i.type===CONST.SHAPES.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(i.type===CONST.SHAPES.ELIP){var a=s.width*2,f=s.height*2,l=s.x-a/2,c=s.y-f/2,h=.5522848,p=a/2*h,d=f/2*h,v=l+a,m=c+f,g=l+a/2,y=c+f/2;t.moveTo(l,y),t.bezierCurveTo(l,y-d,g-p,c,g,c),t.bezierCurveTo(g+p,c,v,y-d,v,y),t.bezierCurveTo(v,y+d,g+p,m,g,m),t.bezierCurveTo(g-p,m,l,y+d,l,y),t.closePath()}else if(i.type===CONST.SHAPES.RREC){var b=s.x,w=s.y,E=s.width,S=s.height,x=s.radius,T=Math.min(E,S)/2|0;x=x>T?T:x,t.moveTo(b,w+x),t.lineTo(b,w+S-x),t.quadraticCurveTo(b,w+S,b+x,w+S),t.lineTo(b+E-x,w+S),t.quadraticCurveTo(b+E,w+S,b+E,w+S-x),t.lineTo(b+E,w+x),t.quadraticCurveTo(b+E,w,b+E-x,w),t.lineTo(b+x,w),t.quadraticCurveTo(b,w,b,w+x),t.closePath()}}},CanvasGraphics.updateGraphicsTint=function(e){if(e.tint===16777215&&e._prevTint===e.tint)return;e._prevTint=e.tint;var t=(e.tint>>16&255)/255,n=(e.tint>>8&255)/255,r=(e.tint&255)/255;for(var i=0;i<e.graphicsData.length;i++){var s=e.graphicsData[i],o=s.fillColor|0,u=s.lineColor|0;s._fillTint=((o>>16&255)/255*t*255<<16)+((o>>8&255)/255*n*255<<8)+(o&255)/255*r*255,s._lineTint=((u>>16&255)/255*t*255<<16)+((u>>8&255)/255*n*255<<8)+(u&255)/255*r*255}};