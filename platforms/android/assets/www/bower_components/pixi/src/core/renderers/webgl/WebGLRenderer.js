function WebGLRenderer(e,t,n){n=n||{},SystemRenderer.call(this,"WebGL",e,t,n),this.type=CONST.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._useFXAA=!!n.forceFXAA&&n.antialias,this._FXAAFilter=null,this._contextOptions={alpha:this.transparent,antialias:n.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:n.preserveDrawingBuffer},this.drawCount=0,this.shaderManager=new ShaderManager(this),this.maskManager=new MaskManager(this),this.stencilManager=new StencilManager(this),this.filterManager=new FilterManager(this),this.blendModeManager=new BlendModeManager(this),this.currentRenderTarget=null,this.currentRenderer=new ObjectRenderer(this),this.initPlugins(),this._createContext(),this._initContext(),this._mapGlModes(),this._renderTargetStack=[]}var SystemRenderer=require("../SystemRenderer"),ShaderManager=require("./managers/ShaderManager"),MaskManager=require("./managers/MaskManager"),StencilManager=require("./managers/StencilManager"),FilterManager=require("./managers/FilterManager"),BlendModeManager=require("./managers/BlendModeManager"),RenderTarget=require("./utils/RenderTarget"),ObjectRenderer=require("./utils/ObjectRenderer"),FXAAFilter=require("./filters/FXAAFilter"),utils=require("../../utils"),CONST=require("../../const");WebGLRenderer.prototype=Object.create(SystemRenderer.prototype),WebGLRenderer.prototype.constructor=WebGLRenderer,module.exports=WebGLRenderer,utils.pluginTarget.mixin(WebGLRenderer),WebGLRenderer.glContextId=0,WebGLRenderer.prototype._createContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=e;if(!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=WebGLRenderer.glContextId++,e.id=this.glContextId,e.renderer=this},WebGLRenderer.prototype._initContext=function(){var e=this.gl;e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.renderTarget=new RenderTarget(e,this.width,this.height,null,this.resolution,!0),this.setRenderTarget(this.renderTarget),this.emit("context",e),this.resize(this.width,this.height),this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!e.getContextAttributes().antialias),this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new FXAAFilter])},WebGLRenderer.prototype.render=function(e){if(this.gl.isContextLost())return;this.drawCount=0,this._lastObjectRendered=e,this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,e.filterArea=this.renderTarget.size,e.filters=this._FXAAFilter);var t=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=t;var n=this.gl;this.setRenderTarget(this.renderTarget),this.clearBeforeRender&&(this.transparent?n.clearColor(0,0,0,0):n.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),n.clear(n.COLOR_BUFFER_BIT)),this.renderDisplayObject(e,this.renderTarget)},WebGLRenderer.prototype.renderDisplayObject=function(e,t,n){this.setRenderTarget(t),n&&t.clear(),this.filterManager.setFilterStack(t.filterStack),e.renderWebGL(this),this.currentRenderer.flush()},WebGLRenderer.prototype.setObjectRenderer=function(e){if(this.currentRenderer===e)return;this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start()},WebGLRenderer.prototype.setRenderTarget=function(e){if(this.currentRenderTarget===e)return;this.currentRenderTarget=e,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(e.stencilMaskStack)},WebGLRenderer.prototype.resize=function(e,t){SystemRenderer.prototype.resize.call(this,e,t),this.filterManager.resize(e,t),this.renderTarget.resize(e,t),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))},WebGLRenderer.prototype.updateTexture=function(e){e=e.baseTexture||e;if(!e.hasLoaded)return;var t=this.gl;return e._glTextures[t.id]||(e._glTextures[t.id]=t.createTexture(),e.on("update",this.updateTexture,this),e.on("dispose",this.destroyTexture,this)),t.bindTexture(t.TEXTURE_2D,e._glTextures[t.id]),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.scaleMode===CONST.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),e.mipmap&&e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===CONST.SCALE_MODES.LINEAR?t.LINEAR_MIPMAP_LINEAR:t.NEAREST_MIPMAP_NEAREST),t.generateMipmap(t.TEXTURE_2D)):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.scaleMode===CONST.SCALE_MODES.LINEAR?t.LINEAR:t.NEAREST),e.isPowerOfTwo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),e._glTextures[t.id]},WebGLRenderer.prototype.destroyTexture=function(e){e=e.baseTexture||e;if(!e.hasLoaded)return;e._glTextures[this.gl.id]&&this.gl.deleteTexture(e._glTextures[this.gl.id])},WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault()},WebGLRenderer.prototype.handleContextRestored=function(){this._initContext();for(var e in utils.BaseTextureCache)utils.BaseTextureCache[e]._glTextures.length=0},WebGLRenderer.prototype.destroy=function(e){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var t in utils.BaseTextureCache){var n=utils.BaseTextureCache[t];n.off("update",this.updateTexture,this),n.off("dispose",this.destroyTexture,this)}SystemRenderer.prototype.destroy.call(this,e),this.uid=0,this.shaderManager.destroy(),this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.blendModeManager.destroy(),this.shaderManager=null,this.maskManager=null,this.filterManager=null,this.blendModeManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this.drawCount=0,this.gl.useProgram(null),this.gl=null},WebGLRenderer.prototype._mapGlModes=function(){var e=this.gl;this.blendModes||(this.blendModes={},this.blendModes[CONST.BLEND_MODES.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],this.blendModes[CONST.BLEND_MODES.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.SCREEN]=[e.SRC_ALPHA,e.ONE],this.blendModes[CONST.BLEND_MODES.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA]),this.drawModes||(this.drawModes={},this.drawModes[CONST.DRAW_MODES.POINTS]=e.POINTS,this.drawModes[CONST.DRAW_MODES.LINES]=e.LINES,this.drawModes[CONST.DRAW_MODES.LINE_LOOP]=e.LINE_LOOP,this.drawModes[CONST.DRAW_MODES.LINE_STRIP]=e.LINE_STRIP,this.drawModes[CONST.DRAW_MODES.TRIANGLES]=e.TRIANGLES,this.drawModes[CONST.DRAW_MODES.TRIANGLE_STRIP]=e.TRIANGLE_STRIP,this.drawModes[CONST.DRAW_MODES.TRIANGLE_FAN]=e.TRIANGLE_FAN)};