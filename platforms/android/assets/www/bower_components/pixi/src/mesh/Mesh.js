function Mesh(e,t,n,r,i){core.Container.call(this),this._texture=null,this.uvs=n||new Float32Array([0,1,1,1,1,0,0,1]),this.vertices=t||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=r||new Uint16Array([0,1,2,3]),this.dirty=!0,this.blendMode=core.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=i||Mesh.DRAW_MODES.TRIANGLE_MESH,this.texture=e}var core=require("../core"),tempPoint=new core.Point,tempPolygon=new core.Polygon;Mesh.prototype=Object.create(core.Container.prototype),Mesh.prototype.constructor=Mesh,module.exports=Mesh,Object.defineProperties(Mesh.prototype,{texture:{get:function(){return this._texture},set:function(e){if(this._texture===e)return;this._texture=e,e&&(e.baseTexture.hasLoaded?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this))}}}),Mesh.prototype._renderWebGL=function(e){e.setObjectRenderer(e.plugins.mesh),e.plugins.mesh.render(this)},Mesh.prototype._renderCanvas=function(e){var t=e.context,n=this.worldTransform;e.roundPixels?t.setTransform(n.a,n.b,n.c,n.d,n.tx|0,n.ty|0):t.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty),this.drawMode===Mesh.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(t):this._renderCanvasTriangles(t)},Mesh.prototype._renderCanvasTriangleMesh=function(e){var t=this.vertices,n=this.uvs,r=t.length/2;for(var i=0;i<r-2;i++){var s=i*2;this._renderCanvasDrawTriangle(e,t,n,s,s+2,s+4)}},Mesh.prototype._renderCanvasTriangles=function(e){var t=this.vertices,n=this.uvs,r=this.indices,i=r.length;for(var s=0;s<i;s+=3){var o=r[s]*2,u=r[s+1]*2,a=r[s+2]*2;this._renderCanvasDrawTriangle(e,t,n,o,u,a)}},Mesh.prototype._renderCanvasDrawTriangle=function(e,t,n,r,i,s){var o=this._texture.baseTexture.source,u=this._texture.baseTexture.width,a=this._texture.baseTexture.height,f=t[r],l=t[i],c=t[s],h=t[r+1],p=t[i+1],d=t[s+1],v=n[r]*u,m=n[i]*u,g=n[s]*u,y=n[r+1]*a,b=n[i+1]*a,w=n[s+1]*a;if(this.canvasPadding>0){var E=this.canvasPadding/this.worldTransform.a,S=this.canvasPadding/this.worldTransform.d,x=(f+l+c)/3,T=(h+p+d)/3,N=f-x,C=h-T,k=Math.sqrt(N*N+C*C);f=x+N/k*(k+E),h=T+C/k*(k+S),N=l-x,C=p-T,k=Math.sqrt(N*N+C*C),l=x+N/k*(k+E),p=T+C/k*(k+S),N=c-x,C=d-T,k=Math.sqrt(N*N+C*C),c=x+N/k*(k+E),d=T+C/k*(k+S)}e.save(),e.beginPath(),e.moveTo(f,h),e.lineTo(l,p),e.lineTo(c,d),e.closePath(),e.clip();var L=v*b+y*g+m*w-b*g-y*m-v*w,A=f*b+y*c+l*w-b*c-y*l-f*w,O=v*l+f*g+m*c-l*g-f*m-v*c,M=v*b*c+y*l*g+f*m*w-f*b*g-y*m*c-v*l*w,_=h*b+y*d+p*w-b*d-y*p-h*w,D=v*p+h*g+m*d-p*g-h*m-v*d,P=v*b*d+y*p*g+h*m*w-h*b*g-y*m*d-v*p*w;e.transform(A/L,_/L,O/L,D/L,M/L,P/L),e.drawImage(o,0,0),e.restore()},Mesh.prototype.renderMeshFlat=function(e){var t=this.context,n=e.vertices,r=n.length/2;t.beginPath();for(var i=1;i<r-2;i++){var s=i*2,o=n[s],u=n[s+2],a=n[s+4],f=n[s+1],l=n[s+3],c=n[s+5];t.moveTo(o,f),t.lineTo(u,l),t.lineTo(a,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},Mesh.prototype._onTextureUpdate=function(){this.updateFrame=!0},Mesh.prototype.getBounds=function(e){if(!this._currentBounds){var t=e||this.worldTransform,n=t.a,r=t.b,i=t.c,s=t.d,o=t.tx,u=t.ty,a=-Infinity,f=-Infinity,l=Infinity,c=Infinity,h=this.vertices;for(var p=0,d=h.length;p<d;p+=2){var v=h[p],m=h[p+1],g=n*v+i*m+o,y=s*m+r*v+u;l=g<l?g:l,c=y<c?y:c,a=g>a?g:a,f=y>f?y:f}if(l===-Infinity||f===Infinity)return core.Rectangle.EMPTY;var b=this._bounds;b.x=l,b.width=a-l,b.y=c,b.height=f-c,this._currentBounds=b}return this._currentBounds},Mesh.prototype.containsPoint=function(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,tempPoint);var t=this.vertices,n=tempPolygon.points,r,i;if(this.drawMode===Mesh.DRAW_MODES.TRIANGLES){var s=this.indices;i=this.indices.length;for(r=0;r<i;r+=3){var o=s[r]*2,u=s[r+1]*2,a=s[r+2]*2;n[0]=t[o],n[1]=t[o+1],n[2]=t[u],n[3]=t[u+1],n[4]=t[a],n[5]=t[a+1];if(tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}}else{i=t.length;for(r=0;r<i;r+=6){n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5];if(tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}}return!1},Mesh.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1};