var Resource=require("resource-loader").Resource,path=require("path"),core=require("../core");module.exports=function(){return function(e,t){if(!e.data||!e.isJson||!e.data.frames)return t();var n={crossOrigin:e.crossOrigin,loadType:Resource.LOAD_TYPE.IMAGE},r=path.dirname(e.url.replace(this.baseUrl,"")),i=core.utils.getResolutionOfUrl(e.url);this.add(e.name+"_image",r+"/"+e.data.meta.image,n,function(n){e.textures={};var r=e.data.frames;for(var s in r){var o=r[s].frame;if(o){var u=null,a=null;r[s].rotated?u=new core.Rectangle(o.x,o.y,o.h,o.w):u=new core.Rectangle(o.x,o.y,o.w,o.h),r[s].trimmed&&(a=new core.Rectangle(r[s].spriteSourceSize.x/i,r[s].spriteSourceSize.y/i,r[s].sourceSize.w/i,r[s].sourceSize.h/i));if(r[s].rotated){var f=u.width;u.width=u.height,u.height=f}u.x/=i,u.y/=i,u.width/=i,u.height/=i,e.textures[s]=new core.Texture(n.texture.baseTexture,u,u.clone(),a,r[s].rotated),core.utils.TextureCache[s]=e.textures[s]}}t()})}};