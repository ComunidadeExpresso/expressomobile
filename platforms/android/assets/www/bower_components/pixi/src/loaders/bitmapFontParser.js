function parse(e,t){var n={},r=e.data.getElementsByTagName("info")[0],i=e.data.getElementsByTagName("common")[0];n.font=r.getAttribute("face"),n.size=parseInt(r.getAttribute("size"),10),n.lineHeight=parseInt(i.getAttribute("lineHeight"),10),n.chars={};var s=e.data.getElementsByTagName("char");for(var o=0;o<s.length;o++){var u=parseInt(s[o].getAttribute("id"),10),a=new core.Rectangle(parseInt(s[o].getAttribute("x"),10)+t.frame.x,parseInt(s[o].getAttribute("y"),10)+t.frame.y,parseInt(s[o].getAttribute("width"),10),parseInt(s[o].getAttribute("height"),10));n.chars[u]={xOffset:parseInt(s[o].getAttribute("xoffset"),10),yOffset:parseInt(s[o].getAttribute("yoffset"),10),xAdvance:parseInt(s[o].getAttribute("xadvance"),10),kerning:{},texture:new core.Texture(t.baseTexture,a)}}var f=e.data.getElementsByTagName("kerning");for(o=0;o<f.length;o++){var l=parseInt(f[o].getAttribute("first"),10),c=parseInt(f[o].getAttribute("second"),10),h=parseInt(f[o].getAttribute("amount"),10);n.chars[c].kerning[l]=h}e.bitmapFont=n,extras.BitmapText.fonts[n.font]=n}var Resource=require("resource-loader").Resource,core=require("../core"),extras=require("../extras"),path=require("path");module.exports=function(){return function(e,t){if(!e.data||!e.isXml)return t();if(e.data.getElementsByTagName("page").length===0||e.data.getElementsByTagName("info").length===0||e.data.getElementsByTagName("info")[0].getAttribute("face")===null)return t();var n=path.dirname(e.url);n==="."&&(n=""),this.baseUrl&&n&&(this.baseUrl.charAt(this.baseUrl.length-1)==="/"&&(n+="/"),n=n.replace(this.baseUrl,"")),n&&n.charAt(n.length-1)!=="/"&&(n+="/");var r=n+e.data.getElementsByTagName("page")[0].getAttribute("file");if(core.utils.TextureCache[r])parse(e,core.utils.TextureCache[r]),t();else{var i={crossOrigin:e.crossOrigin,loadType:Resource.LOAD_TYPE.IMAGE};this.add(e.name+"_image",r,i,function(n){parse(e,n.texture),t()})}}};