function BitmapText(e,t){core.Container.call(this),t=t||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:t.tint!==undefined?t.tint:16777215,align:t.align||"left",name:null,size:0},this.font=t.font,this._text=e,this.maxWidth=0,this.maxLineHeight=0,this.dirty=!1,this.updateText()}var core=require("../core");BitmapText.prototype=Object.create(core.Container.prototype),BitmapText.prototype.constructor=BitmapText,module.exports=BitmapText,Object.defineProperties(BitmapText.prototype,{tint:{get:function(){return this._font.tint},set:function(e){this._font.tint=typeof e=="number"&&e>=0?e:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(e){this._font.align=e||"left",this.dirty=!0}},font:{get:function(){return this._font},set:function(e){if(!e)return;typeof e=="string"?(e=e.split(" "),this._font.name=e.length===1?e[0]:e.slice(1).join(" "),this._font.size=e.length>=2?parseInt(e[0],10):BitmapText.fonts[this._font.name].size):(this._font.name=e.name,this._font.size=typeof e.size=="number"?e.size:parseInt(e.size,10)),this.dirty=!0}},text:{get:function(){return this._text},set:function(e){e=e.toString()||" ";if(this._text===e)return;this._text=e,this.dirty=!0}}}),BitmapText.prototype.updateText=function(){var e=BitmapText.fonts[this._font.name],t=new core.Point,n=null,r=[],i=0,s=0,o=[],u=0,a=this._font.size/e.size,f=-1,l=0;for(var c=0;c<this.text.length;c++){var h=this.text.charCodeAt(c);f=/(\s)/.test(this.text.charAt(c))?c:f;if(/(?:\r\n|\r|\n)/.test(this.text.charAt(c))){o.push(i),s=Math.max(s,i),u++,t.x=0,t.y+=e.lineHeight,n=null;continue}if(f!==-1&&this.maxWidth>0&&t.x*a>this.maxWidth){r.splice(f,c-f),c=f,f=-1,o.push(i),s=Math.max(s,i),u++,t.x=0,t.y+=e.lineHeight,n=null;continue}var p=e.chars[h];if(!p)continue;n&&p.kerning[n]&&(t.x+=p.kerning[n]),r.push({texture:p.texture,line:u,charCode:h,position:new core.Point(t.x+p.xOffset,t.y+p.yOffset)}),i=t.x+(p.texture.width+p.xOffset),t.x+=p.xAdvance,l=Math.max(l,p.yOffset+p.texture.height),n=h}o.push(i),s=Math.max(s,i);var d=[];for(c=0;c<=u;c++){var v=0;this._font.align==="right"?v=s-o[c]:this._font.align==="center"&&(v=(s-o[c])/2),d.push(v)}var m=r.length,g=this.tint;for(c=0;c<m;c++){var y=this._glyphs[c];y?y.texture=r[c].texture:(y=new core.Sprite(r[c].texture),this._glyphs.push(y)),y.position.x=(r[c].position.x+d[r[c].line])*a,y.position.y=r[c].position.y*a,y.scale.x=y.scale.y=a,y.tint=g,y.parent||this.addChild(y)}for(c=m;c<this._glyphs.length;++c)this.removeChild(this._glyphs[c]);this.textWidth=s*a,this.textHeight=(t.y+e.lineHeight)*a,this.maxLineHeight=l*a},BitmapText.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},BitmapText.prototype.getLocalBounds=function(){return this.validate(),core.Container.prototype.getLocalBounds.call(this)},BitmapText.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},BitmapText.fonts={};