/**
 * @license
 * Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
 */

(function(e){function i(e){if(e!==t)throw TypeError("Invalid constructor")}function s(e,n,r){if(e!==t)throw TypeError("Invalid constructor");this._name=n,this._db=r}var t=Object.create(null),n="$SimpleDB$",r="store";if(!e.indexedDB||!indexedDB.open)return;i.prototype={open:function(e){return new Promise(function(i,o){var u=indexedDB.open(n+e);u.onupgradeneeded=function(){var e=u.result;e.createObjectStore(r)},u.onsuccess=function(){var n=u.result;i(new s(t,e,n))},u.onerror=function(){o(u.error)}})},"delete":function(e){return new Promise(function(t,r){var i=indexedDB.deleteDatabase(n+e);i.onsuccess=function(){t(undefined)},i.onerror=function(){r(i.error)}})}},s.cmp=indexedDB.cmp,s.prototype={get name(){return this._name},get:function(e){var t=this;return new Promise(function(n,i){var s=t._db.transaction(r,"readwrite"),o=s.objectStore(r),u=o.get(e);s.oncomplete=function(){n(u.result)},s.onabort=function(){i(s.error)}})},set:function(e,t){var n=this;return new Promise(function(i,s){var o=n._db.transaction(r,"readwrite"),u=o.objectStore(r),a=u.put(t,e);o.oncomplete=function(){i(undefined)},o.onabort=function(){s(o.error)}})},"delete":function(e){var t=this;return new Promise(function(n,i){var s=t._db.transaction(r,"readwrite"),o=s.objectStore(r),u=o.delete(e);s.oncomplete=function(){n(undefined)},s.onabort=function(){i(s.error)}})},clear:function(){var e=this;return new Promise(function(t,n){var i=e._db.transaction(r,"readwrite"),s=i.objectStore(r),o=s.clear();i.oncomplete=function(){t(undefined)},i.onabort=function(){n(i.error)}})},forEach:function(e,t){var n=this;return new Promise(function(i,s){t=t||{};var o=n._db.transaction(r,"readwrite"),u=o.objectStore(r),a=u.openCursor(t.range,t.direction==="reverse"?"prev":"next");a.onsuccess=function(){var t=a.result;if(!t)return;try{var n=e(t.key,t.value);n||t.continue()}catch(r){o.abort()}},o.oncomplete=function(){i(undefined)},o.onabort=function(){s(o.error)}})},getMany:function(e){var t=this;return new Promise(function(n,i){var s=t._db.transaction(r,"readwrite"),o=s.objectStore(r),u=[];e.forEach(function(e){o.get(e).onsuccess(function(e){u.push(e)})}),s.oncomplete=function(){n(u)},s.onabort=function(){i(s.error)}})},setMany:function(e){var t=this;return new Promise(function(n,i){var s=t._db.transaction(r,"readwrite"),o=s.objectStore(r);e.forEach(function(e){o.put(e.value,e.key)}),s.oncomplete=function(){n(undefined)},s.onabort=function(){i(s.error)}})},deleteMany:function(e){var t=this;return new Promise(function(n,i){var s=t._db.transaction(r,"readwrite"),o=s.objectStore(r);e.forEach(function(e){o.delete(e)}),s.oncomplete=function(){n(undefined)},s.onabort=function(){i(s.error)}})}},e.simpleDB=new i(t),e.SimpleDBKeyRange=IDBKeyRange})(self);