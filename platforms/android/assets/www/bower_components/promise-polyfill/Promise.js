function MakePromise(e){function t(e){if(typeof this!="object"||typeof e!="function")throw new TypeError;this._state=null,this._value=null,this._deferreds=[],o(e,r.bind(this),i.bind(this))}function n(t){var n=this;if(this._state===null){this._deferreds.push(t);return}e(function(){var e=n._state?t.onFulfilled:t.onRejected;if(typeof e!="function"){(n._state?t.resolve:t.reject)(n._value);return}var r;try{r=e(n._value)}catch(i){t.reject(i);return}t.resolve(r)})}function r(e){try{if(e===this)throw new TypeError;if(e&&(typeof e=="object"||typeof e=="function")){var t=e.then;if(typeof t=="function"){o(t.bind(e),r.bind(this),i.bind(this));return}}this._state=!0,this._value=e,s.call(this)}catch(n){i.call(this,n)}}function i(e){this._state=!1,this._value=e,s.call(this)}function s(){for(var e=0,t=this._deferreds.length;e<t;e++)n.call(this,this._deferreds[e]);this._deferreds=null}function o(e,t,n){var r=!1;try{e(function(e){if(r)return;r=!0,t(e)},function(e){if(r)return;r=!0,n(e)})}catch(i){if(r)return;r=!0,n(i)}}return t.prototype["catch"]=function(e){return this.then(null,e)},t.prototype.then=function(e,r){var i=this;return new t(function(t,s){n.call(i,{onFulfilled:e,onRejected:r,resolve:t,reject:s})})},t.resolve=function(e){return e&&typeof e=="object"&&e.constructor===t?e:new t(function(t){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t}typeof module!="undefined"&&(module.exports=MakePromise);